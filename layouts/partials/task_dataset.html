<!-- NOTE: this should be /tasks/<task-name> -->
{{$task := path.Base .Page.File.Dir}}
<!-- NOTE: this should be /tasks/<task-name>/<dataset>.md -->
<!-- NOTE: this should match a file named /data/results/<task-name>/<dataset>.json-->
{{$dataset := .Page.File.TranslationBaseName}}

{{$path := path.Join "data/results" $task $dataset}}
{{$url := ".json" |  printf "%s%s" $path}}

<!-- NOTE: no need for range any more, working one at a time -->
{{$dataFile := getJSON $url}}


<!-- From here on out, shameless copy-paste from layouts/shortcodes/task_tables.html -->
{{ $id := strings.Replace $dataFile.name " " "-" }}
{{ $id := strings.Replace $id "(" "" }}
{{ $id := strings.Replace $id ")" "" }}
{{ $id := strings.Replace $id "," "-" }}
{{ $id := strings.Replace $id "." "-" }}
{{ $id := strings.Replace $id "/" "-" }}
{{ $.Scratch.Set "count" 0 }}

<style>
table.dataTable td {
  padding-left: 10px !important;
  padding-right: 10px !important;
}
table.dataTable th {
  padding-left: 10px;
  padding-right: 10px;
}
table.dataTable {
  border-collapse: unset !important;
}

table.dataTable > * > * > * {
  border: 1px solid grey !important;
}

table.dataTable > * > * > th {
  text-align: center !important;
}
.textcell {
  text-align: left !important;
}

.numbercell {
  text-align: right !important;
}

</style>

<script>
    function docReady(fn) {
      // see if DOM is already available
      if (document.readyState === "complete" || document.readyState === "interactive") {
        // call on next available tick
        setTimeout(fn, 1);
      } else {
        document.addEventListener("DOMContentLoaded", fn);
      }
    }

    docReady( function() {
      $(document).ready( function () {
        var table = $({{ printf "#%s" $id }}).DataTable({
          "paging": false,
          "bInfo" : false,
          "searching": false,
          "autoWidth": false,          
          "columns": [
            {{ range $dataFile.headers.names }}
              { 
                name: '{{ . }}', 
                orderable: {{ not (in $dataFile.headers.fixed .) }},
                {{ if strings.HasSuffix . "Raw" }}
                className: 'group_raw',
                {{ else if strings.HasSuffix . "Scaled" }}
                className: 'group_scaled',
                {{ end }}                
              },
            {{ end }}
          ]
        });

        $('input.toggle-vis').on('change',function(){
          var is_checked = $(this).is(':checked');
          // Toggle the visibility
          table.columns('.group_raw').visible(!is_checked);
          table.columns('.group_scaled').visible(is_checked);
        });
        $('input.toggle-vis').change();
      } );
    })
  </script>

  <div align="right">
    Raw
    <label class="switch">
      <input type="checkbox" class="toggle-vis">
      <span class="slider round"></span>
    </label>
    Scaled
  </div>

  <table id="{{ $id }}" class="display center" >
    <thead>
      {{ range $dataFile.headers.names }}
      <th>{{ replaceRE " *(Raw|Scaled)$" "" . 1 }}</th>
      {{ end }}
    </thead>

    {{ range $method := $dataFile.results }}
    <tr>
      {{ range $attr := $dataFile.headers.names }}
        {{ $val := index $method $attr }}
        {{ if (eq $attr "Name")}}
        <td class="textcell">
        {{else if (eq $attr "Paper") }}
        <td style="text-align:center">
        {{ else }}
        <td style="text-align:right">
        {{ end }}
          {{ if (eq $attr "Paper" )}}
            <a href='{{ index $method "Paper URL"}}'> <i class="fas fa-file-alt"></i></a>
          {{ else if (eq $attr "Name")}}
            <a href='{{ index $method "Implementation" }}'>{{ $val}}</a>
          {{ else if (eq $attr "Library")}}
            <a href='{{ $val }}'>v{{ index $method "Version" }}</a>
          {{ else if (eq $attr "Rank")}}
            <strong>{{ $val }}</strong>
          {{ else if not (in "Name Paper Code Year Implementation Library Version" $attr) }}
             {{ lang.NumFmt 2 $val }}
          {{ else }}
            {{ $val }}
          {{ end }}
        </td>
      {{ end }}
    {{ end }}
    </tr>
  </table>
  <br>